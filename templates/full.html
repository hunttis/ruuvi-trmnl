<!--
RuuviTRMNL Plugin Template - Full Layout
Column layout with location/temperature in large font, humidity smaller
Shows timestamps only when sensor quiet for 30+ minutes
-->

<div class="layout layout--row layout--stretch-x gap--large">
  {% for tag in ruuvi_tags %} {% assign now = 'now' | date: '%s' %} {% assign
  lastUpdate = tag.lastTemperatureUpdate | default: tag.lastUpdated | date: '%s'
  %} {% assign minutesOld = now | minus: lastUpdate | divided_by: 60 %} {%
  assign isOffline = false %} {% assign isStale = false %} {% if minutesOld > 60
  %} {% assign isOffline = true %} {% elsif minutesOld > 30 %} {% assign isStale
  = true %} {% endif %}
  <div
    class="layout layout--col gap--small {% if isOffline or isStale %}background--muted{% endif %} padding--medium rounded--small"
  >
    <!-- Location Name with timestamp - Large -->
    <span class="title title--large"
      >{{ tag.name }}{% if isStale and tag.temperature %} ({{
      tag.lastTemperatureUpdate | default: tag.lastUpdated | date: '%H:%M' }}){%
      endif %}</span
    >

    <!-- Temperature - Large -->
    <div class="layout layout--col gap--xsmall">
      <span class="value value--xxlarge value--tnums">
        {% if tag.temperature %}{{ tag.temperature | round: 1 }}°C{% else
        %}-°C{% endif %}
      </span>
    </div>

    <!-- Humidity - Smaller -->
    <div class="layout layout--col gap--xsmall">
      <span class="value value--large value--tnums">
        {% if tag.humidity %}{{ tag.humidity | round: 0 }}%{% else %}-%{% endif
        %}
      </span>
      <span class="label label--small">humidity</span>
    </div>

    <!-- Status if offline or stale -->
    {% if isOffline %}
    <span class="label label--small label--underline">OFFLINE</span>
    {% elsif isStale %}
    <span class="label label--small label--underline"
      >{{ tag.lastUpdated | date: '%d.%m.%Y %H:%M' }}</span
    >
    {% endif %}
  </div>
  {% endfor %}
</div>
